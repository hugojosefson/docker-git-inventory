# docker-inventory-git

[![Build Status](https://travis-ci.org/hugojosefson/docker-git-inventory.svg?branch=master)](https://travis-ci.org/hugojosefson/docker-git-inventory)
[![npm page](https://img.shields.io/npm/v/@hugojosefson/docker-git-inventory.svg)](https://npmjs.com/package/@hugojosefson/docker-git-inventory)
[![License MIT](https://img.shields.io/npm/l/@hugojosefson/docker-git-inventory.svg)](https://tldrlegal.com/license/mit-license)
[![SemVer 2.0.0](https://img.shields.io/badge/SemVer-2.0.0-lightgrey.svg)](https://semver.org/spec/v2.0.0.html)
[![JavaScript Style Guide](https://img.shields.io/badge/code_style-standard-brightgreen.svg)](https://standardjs.com)

## Introduction

This is a library and a service for extracting information from a Docker Swarm
about currently running services, and pushing custom named refs to git repos.
That means you can see the deployment status from your Docker Swarm, in your
development git tools.

## Prerequisite

Node.js, `v13.2.0` or higher, ideally at least `v14.0.0`.

Recommended to install latest via [nvm](https://github.com/nvm-sh/nvm#readme):

```bash
nvm install stable
```

## Usage

```bash
npx --package @hugojosefson/docker-git-inventory docker-git-inventory
```

Gives an inventory.

```bash
npx --package @hugojosefson/docker-git-inventory docker-git-inventory-server
```

Starts an HTTP API server.

## Programmatic access

You can also `import` the module, and use its exported functions
programmatically.

### API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### inventory

Takes an inventory of currently running Docker stacks.

Returns **Highland.Stream&lt;{stack:
[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String),
taskId:
[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String),
image:
[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String),
serviceId:
[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String),
serviceNameLong:
[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String),
serviceName:
[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String),
labels:
[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)}>**
A Highland stream of objects, each describing one service.

#### app

HTTP API for working with `docker-inventory-git`.

##### Parameters

- `options`
  **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)**
  (optional, default `{}`)
  - `options.app` **(Express | Application | IRouter)** Express.js Application
    instance or Router on which to apply paths. (optional, default `express()`)
  - `options.gitAuthentication` **GitAuth** Response for our `AuthCallback` to
    `onAuth`. If `undefined`, `onAuth` will not be used. (optional, default
    `undefined`)
  - `options.onAuth` **AuthCallback** `onAuth` implementation. (optional,
    default `gitAuthentication?()=>gitAuthentication:undefined`)

Returns **(Express | Application | IRouter)** app, mutated.

#### pushRef

Pushes a git commit to its repo, with a specific remoteRef.

##### Parameters

- `options`
  **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)**
  - `options.username`
    **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**
    username for git authentication
  - `options.password`
    **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**
    password for authentication
  - `options.url`
    **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**
    git repo url
  - `options.ref`
    **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**
    the commit to push
  - `options.remoteRef`
    **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**
    name of the remote ref, for example refs/deployed/stage

Returns
**[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>**
resolves when done
